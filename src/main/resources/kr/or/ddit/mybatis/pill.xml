<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pill">




	<select id="pillList"  resultType="pillVO" parameterType="hashmap">		
		SELECT B.*
				FROM(SELECT ROWNUM RNUM, A.*
					FROM (select *
						  from pill_info
						  where 1=1 
						  		<if test="pname !=null">
									and 
									pi_name like '%' || #{pname} || '%' 
								</if>
								<if test="cname !=null">
									or
									pi_b_name = '%'||#{cname}||'%' 
								</if> 

						  		<if test="shapes !=null">
						  		or
						  		<foreach collection="shapes" item="shape" open="(" close=")" separator="or">
						  			pi_shape like #{shapes}
						  		</foreach>
						  		</if>
						  		<if test="colors != null">
						  		or
						  		<foreach collection="colors" item="color" open="(" close=")" separator="or" >
						  			pi_f_color like #{color.value} or pi_b_color like #{color.value}
						  		</foreach>
						  		</if>
						  		<if test="lines !=null">
						  		or
						  		<foreach collection="lines" item="line" open="(" close=")" separator="or">
						  			pi_f_dividing_line like #{line.value} or pi_b_dividing_line like #{line.value}
						  		</foreach>
						  		</if>
					)A
				)B
		<![CDATA[
			   WHERE B.RNUM <= #{startCount}
				 AND B.RNUM >= #{endCount}
		]]>
		 ORDER BY b.pi_no desc
	</select>
	
	<select id="totalCount" parameterType="hashmap" resultType="String">
		select count(*)
		from pill_info
		where 1=1 				<if test="pname !=null">
									and 
									pi_name like '%' || #{pname} || '%' 
								</if>
								<if test="cname !=null">
									or
									pi_b_name = '%'||#{cname}||'%' 
								</if> 

						  		<if test="shapes !=null">
						  		or
						  		<foreach collection="shapes" item="shape" open="(" close=")" separator="or">
						  			pi_shape like #{shape.value}
						  		</foreach>
						  		</if>
						  		<if test="colors != null">
						  		or
						  		<foreach collection="colors" item="color" open="(" close=")" separator="or" >
						  			pi_f_color like #{color.value} or pi_b_color like #{color.value}
						  		</foreach>
						  		</if>
						  		<if test="lines !=null">
						  		or
						  		<foreach collection="lines" item="line" open="(" close=")" separator="or">
						  			pi_f_dividing_line like #{line.value} or pi_b_dividing_line like #{line.value}
						  		</foreach>
						  		</if>		
	</select>
</mapper>
	

	
